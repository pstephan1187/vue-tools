const result=function(e,t){return"object"==typeof e?{passed:e.passed||!1,message:e.message||null,required:e.required||!1}:!0===e?{passed:!0,message:null,required:t||!1}:!1===e?{passed:!1,message:t,required:!1}:void 0},rules={alpha:e=>e.value?/^[a-d]$/i.test(e.value)?result(!0):result(!1,`${e.getErrorLabel()} must only be letters.`):result(!0),between(e,t){if(!e.value)return result(!0);let r=1*t[0],s=1*t[1];return r<=1*e.value&&1*e.value<=s?result(!0):result(!1,`${e.getErrorLabel()} must be between ${r} and ${s}`)},email:e=>e.value?/^.+@.+\..+$/.test(e.value)?result(!0):result(!1,`${e.getErrorLabel()} must be a valid email address.`):result(!0),integer:e=>e.value?/^\d+$/.test(e.value)?result(!0):result(!1,`${e.getErrorLabel()} must be an integer.`):result(!0),required:e=>""!==e.value&&null!==e.value&&void 0!==e.value?result(!0,!0):result({passed:!1,message:`${e.getErrorLabel()} is a required field.`,required:!0}),requiredIf(e,t){let r=t[0];return e.$form.$fields[r].value?!0===rules.required(e)?result(!0,!0):result({passed:!1,message:`${e.getErrorLabel()} is required.`,required:!0}):result(!0)},sameAs(e,t){if(!e.value)return result(!0);let r=e.form.fields[t[0]];return e.value===r.value?result(!0):result(!1,`The ${e.getErrorLabel()} and ${r.getErrorLabel()} must be identical.`)}};let Field;const installField=function(e,t){(Field=e.extend({props:{id:{type:String,required:!0},label:{type:String,default:""},errorLabel:{type:String,default:function(){return this.label}},value:{type:[String,Array,Object,Number,Boolean],default:null},rules:{type:Array,default:()=>[]},userData:{type:[String,Array,Object,Number,Boolean],default:null}},data:()=>({errorList:[],dirty:!1}),computed:{valid(){return 0===this.validationResults.filter(e=>!e.passed).length},required(){for(var e of this.validationResults)if(e.required)return!0;return!1},errors(){let e=this.errorList.slice(0);return{all:e.map(e=>e.message),first:e.length>0?e[0].message:null}},hasErrors(){return this.errorList.length>0},validationResults(){let e=[];for(var t of this.rules){var r,s;if("string"==typeof t){if(-1!==t.indexOf(":")){var[t,s]=t.split(":");s=s.split(",")}r=rules[t]}else"function"==typeof t&&(r=t);let i=r(this,s);e.push({rule:t,passed:i.passed,message:i.message,required:i.required})}return e}},methods:{getErrorLabel(){return this.errorLabel||this.label},clearErrors(){this.errorList=[]},validate(){this.clearErrors();let e=this.validationResults.slice(0).filter(e=>!e.passed);e.length>0&&(this.errorList=e.map(e=>({rule:e.rule,message:e.message})))}},watch:{value(){this.dirty=!0}}})).prototype.$form=null,Field.create=function(e){return new Field({propsData:e})}};let Form;const installForm=function(e,t){(Form=e.extend({props:{label:{type:String,default:""},schema:{type:Array,required:!0}},data:()=>({fields:[]}),computed:{$fields(){let e={};for(var t of this.fields)e[t.id]=t;return e},$valid:function(){for(var e of Object.keys(this.fields))if(!this.fields[e].valid)return!1;return!0},$invalid:function(){return!this.$valid},$errors:function(){let e={all:[]};for(var t of Object.keys(this.fields)){let r=this.fields[t];e.all=e.all.concat(r.errors.all),e[r.id]=r.errors.all}return e},$values:function(){return Object.keys(this.fields).reduce((e,t)=>(e[t]=this.fields[t].value,e),{})}},methods:{getErrors(e){return e in this.fields?this.fields[e].errors.all:[]},hasErrors(e){return e in this.fields&&this.fields[e].hasErrors},firstError(e){return e in this.fields?this.fields[e].errors.first:null},validateAll(){for(let e of Object.keys(this.fields))this.fields[e].validate()},validateAllDirty(){for(let e of Object.keys(this.fields)){let t=this.fields[e];t.dirty&&t.validate()}}},created(){this.fields=this.schema.map(e=>e instanceof Field?e:Field.create(e)).map(e=>(e.$form=this,e))}})).create=function(e){return new Form({propsData:e})}};let Step;const installStep=function(e,t){(Step=e.extend({props:{form:{type:Form,required:!0}},computed:{label(){return this.form.label},isFirst(){return this.$wizard.steps[0]===this},valid(){return this.form.$valid},isActive(){return this.$wizard.currentStep===this},isLast(){return this.$wizard.steps[this.$wizard.steps.length-1]===this}}})).prototype.$wizard=null,Step.create=function(e){return new Step({propsData:e})}};let Wizard;const installWizard=function(e,t){(Wizard=e.extend({props:{schema:{type:Array,required:!0},onComplete:{type:Function,default:()=>{}}},data:()=>({steps:[],currentStepIndex:0}),computed:{currentStep(){return void 0===this.steps[this.currentStepIndex]?null:this.steps[this.currentStepIndex]},canGoBack(){return 0!==this.currentStepIndex},canGoForward(){return this.currentStep.form.$valid}},methods:{previous(){--this.currentStepIndex<0&&(this.currentStepIndex=0)},next(){++this.currentStepIndex>=this.steps.length&&(this.currentStepIndex=this.steps.length-1,this.onComplete())},convertSchema(){this.steps=this.schema.map(e=>e instanceof Step?e:Step.create({form:e})).map(e=>(e.$wizard=this,e))}},created(){this.convertSchema(),this.$watch("schema",this.convertSchema)}})).create=function(e){return new Wizard({propsData:e})}};var focusDirective={inserted(e,{value:t}){!0!==t&&void 0!==t||e.focus()}};const VueTools={install:function(e,t){this.form.install(e,t),this.wizard.install(e,t),this.focus.install(e,t)},form:{install:function(e,t){installForm(e),installField(e)}},wizard:{install:function(e,t){installWizard(e),installStep(e)}},focus:{install(e,t){e.directive("focus",focusDirective)}}};export default VueTools;export{Form,Field,Wizard,Step};
